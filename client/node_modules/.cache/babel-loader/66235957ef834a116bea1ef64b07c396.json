{"ast":null,"code":"'use strict';\n\nconst uint8ArrayEquals = require('uint8arrays/equals');\n\nconst Message = require('../../message');\n\nconst utils = require('../../utils');\n\nmodule.exports = dht => {\n  const log = utils.logger(dht.peerId, 'rpc:find-node');\n  /**\n   * Process `FindNode` DHT messages.\n   *\n   * @param {PeerId} peerId\n   * @param {Message} msg\n   * @returns {Promise<Message>}\n   */\n\n  return async function findNode(peerId, msg) {\n    log('start');\n    let closer;\n\n    if (uint8ArrayEquals(msg.key, dht.peerId.id)) {\n      closer = [{\n        id: dht.peerId\n      }];\n    } else {\n      closer = await dht._betterPeersToQuery(msg, peerId);\n    }\n\n    const response = new Message(msg.type, new Uint8Array(0), msg.clusterLevel);\n\n    if (closer.length > 0) {\n      response.closerPeers = closer;\n    } else {\n      log('handle FindNode %s: could not find anything', peerId.toB58String());\n    }\n\n    return response;\n  };\n};","map":null,"metadata":{},"sourceType":"script"}