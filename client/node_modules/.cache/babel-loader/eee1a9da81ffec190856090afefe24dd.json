{"ast":null,"code":"import asmCrypto from \"asmcrypto-lite\"; //import IPFS from \"ipfs-core\";\n// import IPFS from \"ipfs-mini\";\n\nconst IPFS = require('ipfs-api');\n\nclass ContractFunctions {\n  constructor(web3, accounts, contract) {\n    this.registerInforme = async (informe, title) => {\n      var data = await informe.arrayBuffer(); // console.log(data)\n\n      var data2 = Buffer.from(data); // console.log(data2)\n\n      let uint8data = new Uint8Array(data);\n      let hash = asmCrypto.SHA256.hex(data);\n      const response = await this.contract.methods.getInforme(hash).call();\n\n      if (response.exists) {\n        return \"El informe ya existe.\";\n      }\n\n      const ipfs = new IPFS({\n        host: 'ipfs.infura.io',\n        port: 5001,\n        protocol: 'https'\n      }); // const w = await ipfs.add(data2, (err, ipfsHash) => {\n      //     console.log(err, ipfsHash);\n      //     cid = ipfsHash[0].hash;\n      // })\n\n      const cid = await ipfs.add(data2); ////const ipfs = await IPFS.create(\"https://ipfs.infura.io:5001\")\n      // const ipfs = new IPFS({host: 'ipfs.infura.io', port: 5001, protocol: 'https'})\n      ////const { cid } = await ipfs.add(uint8data)\n      ////await ipfs.stop();\n      // var cid;\n      // ipfs.add(data, (err,hash2) => {\n      //     if(err){\n      //         return console.log(err);\n      //     }\n      //     console.log(\"https://ipfs.infura.io/ipfs/\"+hash2)\n      //     cid = hash2;\n      // })\n      // console.log(\"hey \" + cid)\n\n      await this.contract.methods.registerInforme(hash, title, cid[0].hash).send({\n        from: this.accounts[0]\n      }); // await this.contract.methods.registerInforme(hash, title, cid.toString()).send({ from: this.accounts[0] });\n\n      return \"Informe registrado exitosamente.\";\n    };\n\n    this.getInformeFromFile = async file => {\n      let data = await file.arrayBuffer();\n      let hash = asmCrypto.SHA256.hex(data);\n      const response = await this.getInforme(hash);\n      return response;\n    };\n\n    this.getInforme = async hash => {\n      const response = await this.contract.methods.getInforme(hash).call();\n      return response;\n    };\n\n    this.getAllInformes = async () => {\n      const response = await this.contract.methods.getAllInformes().call();\n      return response;\n    };\n\n    this.registerEntity = async name => {\n      await this.contract.methods.registerEntity(name).send({\n        from: this.accounts[0]\n      });\n      return \"Petición de registro realizada con éxito. Espere a que el administrador apruebe su solicitud.\";\n    };\n\n    this.approveEntity = async address => {\n      await this.contract.methods.approveEntity(address).send({\n        from: this.accounts[0]\n      });\n      return \"Aprobado.\";\n    };\n\n    this.getAllEntities = async () => {\n      const response = await this.contract.methods.getAllEntities().call({\n        from: this.accounts[0]\n      });\n      return response;\n    };\n\n    this.isOwner = async () => {\n      const response = await this.contract.methods.isOwner().call({\n        from: this.accounts[0]\n      });\n      return response;\n    };\n\n    this.isApprovedEntity = async () => {\n      const response = await this.contract.methods.isApprovedEntity().call({\n        from: this.accounts[0]\n      });\n      return response;\n    };\n\n    this.getMyEntityName = async () => {\n      const response = await this.contract.methods.getMyEntityName().call({\n        from: this.accounts[0]\n      });\n      return response;\n    };\n\n    this.web3 = web3;\n    this.accounts = accounts;\n    this.contract = contract;\n  }\n\n}\n\nexport default ContractFunctions;","map":{"version":3,"sources":["/home/ubuntu/Codigo_Javier/client/src/ContractFunctions.js"],"names":["asmCrypto","IPFS","require","ContractFunctions","constructor","web3","accounts","contract","registerInforme","informe","title","data","arrayBuffer","data2","Buffer","from","uint8data","Uint8Array","hash","SHA256","hex","response","methods","getInforme","call","exists","ipfs","host","port","protocol","cid","add","send","getInformeFromFile","file","getAllInformes","registerEntity","name","approveEntity","address","getAllEntities","isOwner","isApprovedEntity","getMyEntityName"],"mappings":"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","sourcesContent":["\r\nimport asmCrypto from \"asmcrypto-lite\";\r\n//import IPFS from \"ipfs-core\";\r\n// import IPFS from \"ipfs-mini\";\r\nconst IPFS = require('ipfs-api');\r\n\r\n\r\nclass ContractFunctions {\r\n    constructor(web3, accounts, contract) {\r\n        this.web3 = web3;\r\n        this.accounts = accounts;\r\n        this.contract = contract;\r\n    }\r\n\r\n\r\n    registerInforme = async (informe, title) => {\r\n        var data = await informe.arrayBuffer();\r\n        // console.log(data)\r\n        var data2 = Buffer.from(data)\r\n        // console.log(data2)\r\n        let uint8data = new Uint8Array(data);\r\n        let hash = asmCrypto.SHA256.hex(data);\r\n\r\n        const response = await this.contract.methods.getInforme(hash).call();\r\n\r\n        if (response.exists) {\r\n            return \"El informe ya existe.\";\r\n        }\r\n    \r\n\r\n        const ipfs = new IPFS({ host: 'ipfs.infura.io', port: 5001, protocol: 'https' });\r\n        // const w = await ipfs.add(data2, (err, ipfsHash) => {\r\n        //     console.log(err, ipfsHash);\r\n        //     cid = ipfsHash[0].hash;\r\n        // })\r\n        const cid = await ipfs.add(data2);\r\n        \r\n        \r\n\r\n        ////const ipfs = await IPFS.create(\"https://ipfs.infura.io:5001\")\r\n        // const ipfs = new IPFS({host: 'ipfs.infura.io', port: 5001, protocol: 'https'})\r\n        ////const { cid } = await ipfs.add(uint8data)\r\n        ////await ipfs.stop();\r\n        // var cid;\r\n        // ipfs.add(data, (err,hash2) => {\r\n        //     if(err){\r\n        //         return console.log(err);\r\n        //     }\r\n        //     console.log(\"https://ipfs.infura.io/ipfs/\"+hash2)\r\n        //     cid = hash2;\r\n        // })\r\n\r\n        // console.log(\"hey \" + cid)\r\n\r\n\r\n        await this.contract.methods.registerInforme(hash, title, cid[0].hash).send({ from: this.accounts[0] });\r\n        // await this.contract.methods.registerInforme(hash, title, cid.toString()).send({ from: this.accounts[0] });\r\n\r\n        return \"Informe registrado exitosamente.\";\r\n    }\r\n\r\n    getInformeFromFile = async (file) => {\r\n        let data = await file.arrayBuffer();\r\n        let hash = asmCrypto.SHA256.hex(data);\r\n        const response = await this.getInforme(hash);\r\n        return response\r\n    }\r\n\r\n    getInforme = async (hash) => {\r\n        const response = await this.contract.methods.getInforme(hash).call();\r\n        return response;\r\n    }\r\n\r\n    getAllInformes = async () => {\r\n        const response = await this.contract.methods.getAllInformes().call();\r\n        return response;\r\n    }\r\n\r\n    registerEntity = async (name) => {\r\n        await this.contract.methods.registerEntity(name).send({ from: this.accounts[0] });\r\n        return \"Petición de registro realizada con éxito. Espere a que el administrador apruebe su solicitud.\"\r\n    }\r\n\r\n    approveEntity = async (address) => {\r\n        await this.contract.methods.approveEntity(address).send({ from: this.accounts[0] });\r\n        return \"Aprobado.\"\r\n    }\r\n\r\n    getAllEntities = async () => {\r\n        const response = await this.contract.methods.getAllEntities().call({ from: this.accounts[0] });\r\n        return response;\r\n    }\r\n\r\n    isOwner = async () => {\r\n        const response = await this.contract.methods.isOwner().call({ from: this.accounts[0] });\r\n        return response;\r\n    }\r\n\r\n    isApprovedEntity = async () => {\r\n        const response = await this.contract.methods.isApprovedEntity().call({ from: this.accounts[0] });\r\n        return response;\r\n    }\r\n\r\n    getMyEntityName = async () => {\r\n        const response = await this.contract.methods.getMyEntityName().call({ from: this.accounts[0] });\r\n        return response;\r\n    }\r\n\r\n}\r\n\r\nexport default ContractFunctions;"]},"metadata":{},"sourceType":"module"}