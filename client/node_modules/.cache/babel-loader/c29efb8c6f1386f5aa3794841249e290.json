{"ast":null,"code":"import asmCrypto from \"asmcrypto-lite\"; //import IPFS from \"ipfs-core\";\n// import IPFS from \"ipfs-mini\";\n\nconst IPFS = require('ipfs-api');\n\nclass ContractFunctions {\n  constructor(web3, accounts, contract) {\n    this.registrarModelo = async (informe, title) => {\n      var data = await informe.arrayBuffer(); // console.log(data)\n\n      var data2 = Buffer.from(data); // console.log(data2)\n\n      let uint8data = new Uint8Array(data);\n      let hash = asmCrypto.SHA256.hex(data);\n      const response = await this.contract.methods.getInforme(hash).call();\n\n      if (response.exists) {\n        return \"El informe ya existe.\";\n      }\n\n      const ipfs = new IPFS({\n        host: 'ipfs.infura.io',\n        port: 5001,\n        protocol: 'https'\n      }); // const w = await ipfs.add(data2, (err, ipfsHash) => {\n      //     console.log(err, ipfsHash);\n      //     cid = ipfsHash[0].hash;\n      // })\n\n      const cid = await ipfs.add(data2); ////const ipfs = await IPFS.create(\"https://ipfs.infura.io:5001\")\n      // const ipfs = new IPFS({host: 'ipfs.infura.io', port: 5001, protocol: 'https'})\n      ////const { cid } = await ipfs.add(uint8data)\n      ////await ipfs.stop();\n      // var cid;\n      // ipfs.add(data, (err,hash2) => {\n      //     if(err){\n      //         return console.log(err);\n      //     }\n      //     console.log(\"https://ipfs.infura.io/ipfs/\"+hash2)\n      //     cid = hash2;\n      // })\n      // console.log(\"hey \" + cid)\n\n      await this.contract.methods.registerInforme(hash, title, cid[0].hash).send({\n        from: this.accounts[0]\n      }); // await this.contract.methods.registerInforme(hash, title, cid.toString()).send({ from: this.accounts[0] });\n\n      return \"Modelo registrado en el sistema.\";\n    };\n\n    this.obtenerModeloFichero = async file => {\n      let data = await file.arrayBuffer();\n      let hash = asmCrypto.SHA256.hex(data);\n      const response = await this.getInforme(hash);\n      return response;\n    };\n\n    this.obtenerModelo = async hash => {\n      const response = await this.contract.methods.getInforme(hash).call();\n      await this.contract.methods.registerEntity(hash).send({\n        from: this.accounts[0]\n      });\n      return response;\n    };\n\n    this.listadoModelos = async () => {\n      const response = await this.contract.methods.getAllInformes().call();\n      return response;\n    };\n\n    this.registrarUser = async name => {\n      await this.contract.methods.registerEntity(name).send({\n        from: this.accounts[0]\n      });\n      return \"Petición de registro solicitada, espere a tener la cuenta activada.\";\n    };\n\n    this.AceptarUser = async address => {\n      await this.contract.methods.approveEntity(address).send({\n        from: this.accounts[0]\n      });\n      return \"Enhorabuena, has sido confirmado y puedes acceder a la aplicación.\";\n    };\n\n    this.listadoUsuarios = async () => {\n      const response = await this.contract.methods.getAllEntities().call({\n        from: this.accounts[0]\n      });\n      return response;\n    };\n\n    this.esPropietario = async () => {\n      console.log(this.accounts[0]);\n      const response = await this.contract.methods.isOwner().call({\n        from: this.accounts[0]\n      });\n      console.log(response);\n      return response;\n    };\n\n    this.userValidado = async () => {\n      console.log(\"comprobar address\");\n      console.log(this.accounts[0]);\n      const response = await this.contract.methods.isApprovedEntity().call({\n        from: this.accounts[0]\n      });\n      console.log(response);\n      return response;\n    };\n\n    this.getNombreUser = async () => {\n      const response = await this.contract.methods.getMyEntityName().call({\n        from: this.accounts[0]\n      });\n      console.log(response);\n      return response;\n    };\n\n    this.web3 = web3;\n    this.accounts = accounts;\n    this.contract = contract;\n  }\n\n}\n\nexport default ContractFunctions;","map":{"version":3,"sources":["/home/ubuntu/TFG_FL/client/src/ContractFunctions.js"],"names":["asmCrypto","IPFS","require","ContractFunctions","constructor","web3","accounts","contract","registrarModelo","informe","title","data","arrayBuffer","data2","Buffer","from","uint8data","Uint8Array","hash","SHA256","hex","response","methods","getInforme","call","exists","ipfs","host","port","protocol","cid","add","registerInforme","send","obtenerModeloFichero","file","obtenerModelo","registerEntity","listadoModelos","getAllInformes","registrarUser","name","AceptarUser","address","approveEntity","listadoUsuarios","getAllEntities","esPropietario","console","log","isOwner","userValidado","isApprovedEntity","getNombreUser","getMyEntityName"],"mappings":"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","sourcesContent":["\r\nimport asmCrypto from \"asmcrypto-lite\";\r\n//import IPFS from \"ipfs-core\";\r\n// import IPFS from \"ipfs-mini\";\r\nconst IPFS = require('ipfs-api');\r\n\r\n\r\nclass ContractFunctions {\r\n    constructor(web3, accounts, contract) {\r\n        this.web3 = web3;\r\n        this.accounts = accounts;\r\n        this.contract = contract;\r\n    }\r\n    \r\n\r\n\r\n    registrarModelo = async (informe, title) => {\r\n        var data = await informe.arrayBuffer();\r\n        // console.log(data)\r\n        var data2 = Buffer.from(data)\r\n        // console.log(data2)\r\n        let uint8data = new Uint8Array(data);\r\n        let hash = asmCrypto.SHA256.hex(data);\r\n\r\n        const response = await this.contract.methods.getInforme(hash).call();\r\n\r\n        if (response.exists) {\r\n            return \"El informe ya existe.\";\r\n        }\r\n    \r\n\r\n        const ipfs = new IPFS({ host: 'ipfs.infura.io', port: 5001, protocol: 'https' });\r\n        // const w = await ipfs.add(data2, (err, ipfsHash) => {\r\n        //     console.log(err, ipfsHash);\r\n        //     cid = ipfsHash[0].hash;\r\n        // })\r\n        const cid = await ipfs.add(data2);\r\n        \r\n        \r\n\r\n        ////const ipfs = await IPFS.create(\"https://ipfs.infura.io:5001\")\r\n        // const ipfs = new IPFS({host: 'ipfs.infura.io', port: 5001, protocol: 'https'})\r\n        ////const { cid } = await ipfs.add(uint8data)\r\n        ////await ipfs.stop();\r\n        // var cid;\r\n        // ipfs.add(data, (err,hash2) => {\r\n        //     if(err){\r\n        //         return console.log(err);\r\n        //     }\r\n        //     console.log(\"https://ipfs.infura.io/ipfs/\"+hash2)\r\n        //     cid = hash2;\r\n        // })\r\n\r\n        // console.log(\"hey \" + cid)\r\n\r\n\r\n        await this.contract.methods.registerInforme(hash, title, cid[0].hash).send({ from: this.accounts[0] });\r\n        // await this.contract.methods.registerInforme(hash, title, cid.toString()).send({ from: this.accounts[0] });\r\n\r\n        return \"Modelo registrado en el sistema.\";\r\n    }\r\n\r\n    obtenerModeloFichero = async (file) => {\r\n        let data = await file.arrayBuffer();\r\n        let hash = asmCrypto.SHA256.hex(data);\r\n        const response = await this.getInforme(hash);\r\n        return response\r\n    }\r\n\r\n    obtenerModelo = async (hash) => {\r\n        const response = await this.contract.methods.getInforme(hash).call();\r\n        await this.contract.methods.registerEntity(hash).send({ from: this.accounts[0] });\r\n        return response;\r\n    }\r\n\r\n    listadoModelos = async () => {\r\n        const response = await this.contract.methods.getAllInformes().call();\r\n        return response;\r\n    }\r\n\r\n    registrarUser = async (name) => {\r\n        await this.contract.methods.registerEntity(name).send({ from: this.accounts[0] });\r\n        return \"Petición de registro solicitada, espere a tener la cuenta activada.\"\r\n    }\r\n\r\n    AceptarUser = async (address) => {\r\n        await this.contract.methods.approveEntity(address).send({ from: this.accounts[0] });\r\n        return \"Enhorabuena, has sido confirmado y puedes acceder a la aplicación.\"\r\n    }\r\n\r\n    listadoUsuarios = async () => {\r\n        const response = await this.contract.methods.getAllEntities().call({ from: this.accounts[0] });\r\n        return response;\r\n    }\r\n\r\n    esPropietario = async () => {\r\n    \tconsole.log(this.accounts[0]);\r\n        const response = await this.contract.methods.isOwner().call({ from: this.accounts[0] });\r\n        console.log(response);\r\n        return response;\r\n    }\r\n\r\n    userValidado = async () => {\r\n    \tconsole.log(\"comprobar address\");\r\n    \tconsole.log(this.accounts[0]);\r\n        const response = await this.contract.methods.isApprovedEntity().call({ from: this.accounts[0] });\r\n        console.log(response);\r\n        return response;\r\n    }\r\n\r\n    getNombreUser = async () => {\r\n        const response = await this.contract.methods.getMyEntityName().call({ from: this.accounts[0] });\r\n        console.log(response);\r\n        return response;\r\n    }\r\n\r\n}\r\n\r\nexport default ContractFunctions;\r\n"]},"metadata":{},"sourceType":"module"}