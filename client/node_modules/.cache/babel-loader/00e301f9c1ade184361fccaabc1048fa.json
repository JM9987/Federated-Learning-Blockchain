{"ast":null,"code":"'use strict';\n\nconst _require = require('bignumber.js'),\n      Big = _require.default;\n\nconst CID = require('cids');\n\nconst withTimeoutOption = require('ipfs-core-utils/src/with-timeout-option');\n/**\n * @param {Object} config\n * @param {import('.').NetworkService} config.network\n */\n\n\nmodule.exports = ({\n  network\n}) => {\n  /**\n   * Show diagnostic information on the bitswap agent.\n   * Note: `bitswap.stat` and `stats.bitswap` can be used interchangeably.\n   *\n   * @example\n   * ```js\n   * const stats = await ipfs.bitswap.stat()\n   * console.log(stats)\n   * // {\n   * //   provideBufLen: 0,\n   * //   wantlist: [ CID('QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM') ],\n   * //   peers:\n   * //    [ 'QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM',\n   * //      'QmSoLSafTMBsPKadTEgaXctDQVcqN88CNLHXMkTNwMKPnu',\n   * //      'QmSoLer265NRgSp2LA3dPaeykiS1J6DifTC88f5uVQKNAd' ],\n   * //   blocksReceived: 0,\n   * //   dataReceived: 0,\n   * //   blocksSent: 0,\n   * //   dataSent: 0,\n   * //   dupBlksReceived: 0,\n   * //   dupDataReceived: 0\n   * // }\n   * ```\n   * @param {import('.').AbortOptions} [options]\n   * @returns {Promise<BitswapStats>}\n   */\n  async function stat(options) {\n    const _ref = await network.use(options),\n          bitswap = _ref.bitswap;\n\n    const snapshot = bitswap.stat().snapshot;\n    return {\n      provideBufLen: parseInt(snapshot.providesBufferLength.toString()),\n      blocksReceived: new Big(snapshot.blocksReceived),\n      wantlist: Array.from(bitswap.getWantlist()).map(e => e[1].cid),\n      peers: bitswap.peers().map(id => new CID(id.toB58String())),\n      dupBlksReceived: new Big(snapshot.dupBlksReceived),\n      dupDataReceived: new Big(snapshot.dupDataReceived),\n      dataReceived: new Big(snapshot.dataReceived),\n      blocksSent: new Big(snapshot.blocksSent),\n      dataSent: new Big(snapshot.dataSent)\n    };\n  }\n\n  return withTimeoutOption(stat);\n};\n/**\n * @typedef {object} BitswapStats - An object that contains information about the bitswap agent\n * @property {number} provideBufLen - an integer\n * @property {CID[]} wantlist\n * @property {CID[]} peers - array of peer IDs\n * @property {Big} blocksReceived\n * @property {Big} dataReceived\n * @property {Big} blocksSent\n * @property {Big} dataSent\n * @property {Big} dupBlksReceived\n * @property {Big} dupDataReceived\n */","map":null,"metadata":{},"sourceType":"script"}